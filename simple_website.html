<!doctype html>
<html>
  <body>
    <input id="files" type="file" multiple>
    <button id="upload">Upload</button>
    <div id="status"></div>

    <script>
      const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbz7dX1iXwDeMpryHiVYh4QhZLixxzIaRt8uSMrHHdgFlvmJC9N5wmTG7Obg5Gi07wNW/exec"; // replace

      function fileToBase64(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => resolve(reader.result.split(',')[1]); // remove data:<mime>;base64,
          reader.onerror = reject;
          reader.readAsDataURL(file);
        });
      }

      document.getElementById('upload').addEventListener('click', async () => {
        const files = document.getElementById('files').files;
        if (!files.length) return alert('Select files first');
        const status = document.getElementById('status');
        status.innerHTML = '';

        for (const f of files) {
          status.innerHTML += `<div>Uploading ${f.name} ...</div>`;
          try {
            const base64 = await fileToBase64(f);
            const payload = { name: f.name, mimeType: f.type, base64 };
            const res = await fetch(WEBAPP_URL, {
              method: 'POST',
              body: JSON.stringify(payload),
              headers: { 'Content-Type': 'application/json' }
            });
            const j = await res.json();
            status.innerHTML += `<div>Result: ${j.status} ${j.name || j.message}</div>`;
          } catch (err) {
            status.innerHTML += `<div style="color:red">Error uploading ${f.name}: ${err}</div>`;
          }
        }
      });
    </script>
  </body>
</html>
